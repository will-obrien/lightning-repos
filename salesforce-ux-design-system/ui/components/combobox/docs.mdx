import CodeView from '../../../shared/components/CodeView';
import CodeBlock from '../../../shared/components/CodeBlock';
import Blockquote from '../../../shared/components/Blockquote';
import Example from '../../../shared/components/Example';
import Combobox, {ComboboxGroup} from './';
import ObjectSwitcher, {IconObjectSwitcher} from './object-switcher/';
import Listbox, { ListboxGroup, ListboxWrapper, Option } from './listbox/';
import ListboxOfSelections from './listbox-of-pills/';
import ButtonIcon from '../button-icons/';
import { UtilityIcon } from '../icons/base/example';
import { StandardIcon } from '../icons/standard/example';
import * as Snapshot from './snapshots.data';
import _ from '../../shared/helpers';

<div className="lead doc">
  A widget that provides a user with an input field that is either an autocomplete or readonly, accompanied by a listbox of options.
</div>

## Base Combobox

A Base Combobox is a readonly text `input` that allows a user to select an option from a pre-defined list of options. It does not allow free form user input, nor does it allow the user to modify the selected value.

<Example title="Combobox - Base">
  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-1"
      readonly
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-1" snapshot={Snapshot.ObjectOptions} type="plain" count={8} visualSelection />}
      hasInteractions
    />
  </CodeView>
</Example>

### Combobox markup

- A Combobox must come with an associated `label` element, with an appropriate `for` attribute
- `slds-combobox` acts as the root node to the composite Combobox widget. It takes the `role="combobox"` attribute as a result
  - `aria-haspopup="listbox"` attribute is then applied to indicate the Combobox will display a popup, of type `listbox`
  - `aria-expanded="true|false"` attribute is applied to describe whether the popup of `listbox` is currently visible or not
- The element `slds-combobox__form-element` between the `combobox` and its `input` must have `role="none"`

### Input markup

- The `input` is an `input` with a role of `textbox`. The role is implicit on inputs, but in this case it doesn't hurt to be explicit
- The `input` has the following attributes:
  - `autocomplete="off"` to remove the browsers' suggestions from the `input`
  - `aria-controls=""` which points to the ID of the `listbox`. It informs assistive technology what DOM node the `input` controls, in terms of visibility and / or content
  - `type` attribute set to be `text` as it's not a search field
  - `readonly`

### Displaying options

To toggle visibility of the `listbox`, add the class `slds-is-open` to the `slds-dropdown-trigger` element.

It is most common to expand the `listbox` of options when a user clicks on the Combobox. For a more detailed description of interaction behaviors, see the [Interaction](#Interaction) section.

<Blockquote type="a11y" header="Accessibility Requirement">
  When toggling visibility of the Combobox, the <code className="doc">aria-expanded</code> attribute needs to be toggled to <code className="doc">true</code>. Set it to <code className="doc">false</code> again when the options are hidden.
</Blockquote>

<Blockquote type="a11y" header="Accessibility Note">
  The <code className="doc">listbox</code> of options must be an <b>owned</b> child of the <code className="doc">combobox</code>. If it cannot be a direct child of the <code className="doc">combobox</code> element, then <code className="doc">aria-owns</code> must be placed on the <code className="doc">combobox</code> and point to the ID of the <code className="doc">listbox</code> instead.
</Blockquote>

<Example title="Combobox - Displaying Options">
  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-2"
      readonly
      value="Accounts"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={
        <Listbox
          id="listbox-id-2"
          snapshot={Snapshot.ObjectOptions}
          type="plain"
          count={8}
          visualSelection
        />
      }
      isOpen
      hasFocus
    />
  </CodeView>
</Example>

#### Listbox markup

- The `listbox` has `role="listbox"` applied
- The `listbox` can have child `option`s. We place `role="option"` on a `div` element, inside a list item. As such the list item `li` needs to be removed from the Accessibility Tree with `role="presentation"`
- A `listbox` has the ability to group options together under a visual heading or label. This means the `role="listbox"` attribute is placed on a common parent element, which can wrap multiple lists (or groups) of options
  - When a `listbox` has no option groups, the `ul` element has `role="presentation"` to remove it from the Accessibility Tree
- Every `option` has `aria-selected="false"` by default
- Disabled `option`s should have `aria-disabled="true"` applied

#### Loading more options

If you are dynamically loading in more items to the listbox, the very last `<li>` of the `<ul>` should receive the `role="presentation"` attribute and have the [Spinner component](/components/spinners/)  injected into it.

For layout purposes, wrap the spinner in a `<div>` with the class `slds-align_absolute-center` to position the spinner in the middle of the list item, as well as `slds-p-top_medium` to provide the appropiate amount of space for the spinner to be visible.

<Example title="Combobox - Loading Options">
  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-222"
      readonly
      value="Accounts"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={
        <Listbox
          id="listbox-id-222"
          snapshot={Snapshot.ObjectOptions}
          type="plain"
          count={3}
          visualSelection
          loading
        />
      }
      isOpen
      hasFocus
    />
  </CodeView>
</Example>

### Grouped options

Options within a `listbox` can be grouped together under meaningful headings. This is useful if you wish to create separation between 2 or more sets of options within a single `listbox`.

<Example title="Combobox - Grouped Options">
  <CodeView style={{maxWidth: '40rem', height: '17rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-3"
      readonly
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={
        <ListboxWrapper id="listbox-id-3" className="slds-dropdown slds-dropdown_fluid">
          <ListboxGroup
            aria-label="Group One"
            snapshot={Snapshot.PlainOptionsGroupOne}
            count={3}
          />
          <ListboxGroup
            aria-label="Group Two"
            snapshot={Snapshot.PlainOptionsGroupTwo}
            count={3}
          />
        </ListboxWrapper>
      }
      isOpen
      hasFocus
    />
  </CodeView>
</Example>

#### Grouped listbox markup

- When a `listbox` has option groups, each group gets a visual label. Exactly like `optgroup` in a `select` element
  - The `ul` element in this case has `role="group"` with an `aria-label` that matches the visible label
  - Display the group label visually, but due to the way a `listbox` works it can only be marked as `role="presentation"`, as a `listbox` can only have `option` children. This allows us to communicate the group label visually and programmatically to a screen reader

### Styling choices for options

The options in the `listbox` can have a left icon and/or metatext.

<CodeView style={{position: 'relative', maxWidth: '20rem', height: '12rem'}}>
  <Listbox
    id="listbox-id-2"
    snapshot={Snapshot.PlainStylingOptions}
    type="plain"
    count={4}
  />
</CodeView>

### Interaction

At its most basic, the `listbox` of options should be displayed when a user interacts with the Combobox. When the user leaves the combobox the options are hidden. However, there are some differences when interacting with a Combobox with a mouse versus with a keyboard.

#### Expanding the Combobox

A mouse or pointer device user can click on a Combobox and the `listbox` will display automatically whilst focus is placed inside the Combobox input field.

<Example title="Combobox - Handling focus">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-4"
      readonly
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-4" snapshot={Snapshot.ObjectOptions} type="plain" count={8} visualSelection />}
      isOpen
      hasFocus
    />
  </CodeView>

</Example>

If using a keyboard, placing focus into the Combobox input field _will not_ display the `listbox` of options automatically.

<Example title="Combobox - Handling focus with a keyboard">

  <CodeView style={{maxWidth: '40rem', height: '5rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-4"
      readonly
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-4" snapshot={Snapshot.ObjectOptionsFocused} type="plain" count={8} visualSelection />}
      hasFocus
    />
  </CodeView>

</Example>

After focusing inside the Combobox with the keyboard, pressing the `Down` or `Enter` key will expand the collapsed Combobox and display the `listbox` options. Be sure to update `aria-expanded` to be true. This will also highlight the first option in the listbox.

<Blockquote type="a11y" header="Accessibility Requirement">
  Update <code className="doc">aria-expanded</code> to "true" when the Combobox is expanded.
</Blockquote>

#### Highlighting an option

To Highlight an option in the `Listbox` use the `Up` and `Down` arrow keys to cycle through all the available options in the list.

- Each press of the arrow key **must** update the `input` value to reflect the currently selected option
- It is common to loop the selected option to the first option when you get to the last option in the list. Similarly, loop to the last option when you reach the first option.

When an option from the `listbox` is "in focus", user focus never leaves the `input` field, since we manually create a programmatic or "faux focus" state that highlights the selected option and associates it to the `input`.

<Blockquote type="a11y" header="Accessibility Requirement">
  When highlighting an option with "faux focus", the <code className="doc">aria-activedescendant</code> attribute on the <code className="doc">input</code> needs to be set to the value of the ID of the highlighted option. The highlighted option must also have <code className="doc">aria-selected="true"</code>. When no option is highlighted, <code className="doc">aria-activedescendant</code> must be removed.
</Blockquote>

By typing the first letter of an option name, the first matching option will highlight. When the letter doesn't match an option, highlighting doesn't move.

<Example title="Combobox - Highlighting an option">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-4"
      readonly
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-4" snapshot={Snapshot.ObjectOptionsFocused} type="plain" count={8} visualSelection />}
      aria-activedescendant="option1"
      isOpen
      hasFocus
    />
  </CodeView>

</Example>

#### Collapsing the Combobox

To collapse the Combobox the user should be able to press the `Escape` key on their keyboard or click anywhere outside of the Combobox.

Pressing the `Enter` key whilst an option is highlighted will select the option as the current value and collapse the Combobox.

<Blockquote type="a11y" header="Accessibility Requirement">
  Update <code className="doc">aria-expanded</code> to "false" when the Combobox is collapsed.
</Blockquote>

### Selecting an option

A user selects an option by using their mouse to click the option they require, or pressing the `Enter` key once they have arrowed to the desired option.

Upon selection the Combobox collapses, only showing the `input` field. The value of the `input` inside the Combobox is set to match the selected option name so the user can see what was previously selected from the `listbox` of options.

<Example title="Combobox - Selecting an Option">

  <div className="docs-codeblock-example">
    <div style={{maxWidth: '40rem'}}>
      <Combobox
        id={_.uniqueId('combobox-id-')}
        aria-controls="listbox-id-5"
        readonly
        value="Accounts"
        inputIconPosition="right"
        rightInputIcon={
          <UtilityIcon
            symbol="down"
            className="slds-icon slds-icon_x-small slds-icon-text-default"
            containerClassName="slds-input__icon slds-input__icon_right"
            assistiveText={false}
            title={false}
          />
        }
        listbox={
          <Listbox
            id="listbox-id-5"
            snapshot={Snapshot.ObjectOptionsSingleSelection}
            type="plain"
            count={8}
            visualSelection
          />
        }
      />
    </div>
  </div>

</Example>

#### Single selection

When an option becomes selected, the class `slds-is-selected` should be applied to the `slds-listbox__option` element with the `role="option"`. This will provide visual feedback that the user has selected that element.

<Example title="Combobox - Single Selection">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-6"
      readonly
      value="Accounts"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={
        <Listbox
          id="listbox-id-6"
          snapshot={Snapshot.ObjectOptionsSingleSelection}
          type="plain"
          count={8}
          visualSelection
        />
      }
      aria-activedescendant="option1"
      isOpen
      hasFocus
    />
  </CodeView>

</Example>

##### Re-opening with a selection

When re-opening a Combobox that already has a selected value, the `listbox` should be displayed with the selected option already highlighted.

<Blockquote type="a11y" header="Accessibility Requirement">
  Be sure to re-set the <code className="doc">aria-activedescendant</code> attribute on the `input` to the value of the ID of the highlighted option. The highlighted option must also have <code className="doc">aria-selected="true"</code>.
</Blockquote>

#### Multiple selections

When more than one option has been selected, the value of the `input` should be updated with the total number of selected items, such as "3 options selected".

<Blockquote type="a11y" header="Accessibility Note">
  The value of the Combobox is the only way you can communicate what option was selected to a screen reader. Given that the option names don't appear in the set value, adding "Current Selection:" to each selected option name allows a screen reader user to understand that the option was already selected from the list.
</Blockquote>

<CodeBlock toggleCode={false}>
  <Option
    name="Accounts"
    selected
  />
</CodeBlock>

<Example title="Combobox - Multiple Selections">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-7"
      readonly
      value="2 Options Selected"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={
        <Listbox
          id="listbox-id-7"
          snapshot={Snapshot.ObjectOptionsMultiSelection}
          type="plain"
          count={8}
          visualSelection
        />
      }
      isOpen
      hasFocus
    />
  </CodeView>

</Example>

When a Combobox with multiple selected options is closed, a [Listbox of Pills](/components/pills?variant=listbox-of-pill-options) is also used to represent those selected options.

The [Listbox of Pills](/components/pills?variant=listbox-of-pill-options) is positioned below the read-only `input`, outside of the Combobox. Each pill represents a selected option. This allows a user to easily see and remove selected items from the Combobox without opening it again.

<Example title="Combobox - Multiple selection closed">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-8"
      readonly
      value="2 Options Selected"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="down"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={
        <Listbox
          id="listbox-id-8"
          snapshot={Snapshot.ObjectOptionsMultiSelection}
          type="plain"
          count={8}
          visualSelection
        />
      }
      listboxOfSelections={
        <ListboxOfSelections
          snapshot={Snapshot.ObjectOptionsSelected}
          count={2}
        />
      }
    />
  </CodeView>

</Example>

#### Editing multiple selections

The [Listbox of Pills](/components/pills?variant=listbox-of-pill-options) allows you to quickly remove selections without opening the Combobox by clicking the remove "x" or using your delete key.

The [Listbox of Pills](/components/pills?variant=listbox-of-pill-options) acts as a single focusable element. Using the arrow keys whilst focused on the first pill will cycle the user through the pill options.

## Autocomplete Combobox

An autocomplete Combobox also allows a user to select an option from a list, but that list can be affected by what the user types into the `input` of the Combobox. This can be useful when the list of options is very large, as user input can start to display options that only match the text they have entered.

If no option matches, the user can complete the value of the combobox by finishing their own text entry.

<Blockquote type="a11y" header="Accessibility Difference">
  The difference between the <strong>Base Combobox</strong> and the <strong>Autocomplete Combobox</strong>, is that the text <code className="doc">input</code> must have the <code className="doc">readonly</code> attribute removed and replaced with <code className="doc">aria-autocomplete="list"</code>.
</Blockquote>

<Example title="Combobox - Autocomplete">

  <CodeView style={{maxWidth: '40rem', height: '12rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-9"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-9" snapshot={Snapshot.PlainOptions} type="plain" count={3} />}
      hasInteractions
    />
  </CodeView>

</Example>

### Displaying options

Displaying options for the Autocomplete Combobox happens just like the base Combobox, except there is no difference between mouse and keyboard users when interacting with the Combobox for the first time. Clicking or placing focus on the Combobox text `input` will automatically expand the Combobox and display the options.

When a user stops interacting with the Combobox, or selects an option, the Combobox collapses and hides the options.

<Example title="Combobox - Autocomplete - Displaying Options">

  <CodeView style={{maxWidth: '40rem', height: '12rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-10"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-10" snapshot={Snapshot.PlainOptions} type="plain" count={3} />}
      isOpen
      hasFocus
    />
  </CodeView>

</Example>

### Displaying options based on user input

If an option from the pre-populated `listbox` isn't what the user wants, they can start typing into the `input`. This term will be used to filter the options by and narrow down the size of the list to something more relevant.

Whilst typing, the highlighted option in the `listbox` should be the user's text string.

<Blockquote type="a11y" header="Accessibility Requirement">
  When highlighting an option with "faux focus", the <code className="doc">aria-activedescendant</code> attribute on the `input` needs to be set to the value of the ID of the highlighted option. The highlighted option must also have <code className="doc">aria-selected="true"</code>.
</Blockquote>

<Example title="Combobox - Autocomplete - Displaying options based on user input">

  <CodeView style={{maxWidth: '40rem', height: '12rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-11"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      value="opp"
      listbox={<Listbox id="listbox-id-11" snapshot={Snapshot.PlainOptionsTypeahead} term="opp" type="plain" count={4} />}
      isOpen
      hasFocus
    />
  </CodeView>

</Example>

### Drill In for Autocomplete

The options in the autocomplete `listbox` can have a right icon to indicate an option that drills in for more options.

<CodeView style={{position: 'relative', maxWidth: '20rem', height: '10rem'}}>
  <Listbox
    id="listbox-id-3"
    snapshot={Snapshot.EntityStylingOptions}
    type="entity"
    count={3}
    visualSelection
  />
</CodeView>

### Keyboard interaction

The same keyboard interactions apply from the base Combobox, but with these differences:

- `Up` and `Down` arrows **should optionally** update the `input` value to reflect the currently selected option

<Example title="Combobox - Autocomplete - Keyboard interactions">

  <CodeView style={{maxWidth: '40rem', height: '12rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-12"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-12" snapshot={Snapshot.PlainOptionsFocused} type="plain" count={3} />}
      aria-activedescendant="option1"
      isOpen
      hasFocus
    />
  </CodeView>

</Example>

### Selecting an option

The user again can click on the desired option or press the `Enter` key with the desired option highlighted. Alternatively they can leave their entered text string as the value of the Combobox.

Selecting an option from the `listbox` will close the `listbox`.

To remove the selected option, simply clear the text `input`.

<Example title="Combobox - Autocomplete - Selecting an option">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-unique-id-03"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <ButtonIcon
          className="slds-input__icon slds-input__icon_right"
          symbol="clear"
          title="Clear the text input"
          assistiveText="Clear the text input"
        />
      }
      listbox={<Listbox id="listbox-unique-id-03" snapshot={Snapshot.PlainOptions} type="entity" count={3} />}
      value="GenePoint"
    />
  </CodeView>

</Example>

### Multiple selection

Multiple selection is much the same as the Base Combobox. A list of selected options are displayed below the Combobox as a [Listbox of Pills](/components/pills?variant=listbox-of-pill-options).

<Example title="Combobox - Autocomplete - Multiple selections">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-13"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-13" snapshot={Snapshot.PlainOptions} type="entity" count={3} />}
      hasSelection
      listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.PlainOptionsSelected} count={2} />}
    />
  </CodeView>

</Example>

#### Editing multiple selections

The [Listbox of Pills](/components/pills?variant=listbox-of-pill-options) allows you to quickly remove selections without opening the Combobox by clicking the remove "x" or using your delete key.

The [Listbox of Pills](/components/pills?variant=listbox-of-pill-options) acts as a single focusable element. Using the arrow keys whilst focused on the first pill will cycle the user through the pill options.

## Entity Autocomplete Combobox (Lookup)

An Entity Autocomplete Combobox or Lookup, is used to search for and select Salesforce Entities.

<Example title="Combobox - Autocomplete - Entity">

  <CodeView style={{maxWidth: '40rem', height: '10rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-14"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-14" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
      hasInteractions
    />
  </CodeView>

</Example>

### Displaying options

Displaying options happens just like an Autocomplete Combobox, by placing user focus inside the Combobox text `input`.

The options now have extra information about them, such as the type of entity and any other important metadata.

<Example title="Combobox - Autocomplete - Entity - Displaying options">

  <CodeView style={{maxWidth: '40rem', height: '10rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-15"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-15" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
      isOpen
      hasFocus
    />
  </CodeView>

</Example>

### Displaying options based on user input

As with the Autocomplete Combobox, the user can start typing into the `input` to search for Salesforce Entities that match their search term.

In the resultant displayed options, we highlight the matched term by bolding it using the `<mark>` element.

<Example title="Combobox - Autocomplete - Entity - Displaying options based on user input">
  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-16"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      value="salesforce"
      listbox={<Listbox id="listbox-id-16" snapshot={Snapshot.EntityOptionsTypeahead} term="salesforce" type="entity" count={4} />}
      aria-activedescendant="option0"
      isOpen
      hasFocus
    />
  </CodeView>
</Example>

### Keyboard interaction

The same keyboard interactions apply from the base Combobox, but with these differences:

- `Up` and `Down` arrows **should not** update the `input` value to reflect the currently selected option. The `input` value should only be updated upon selection.

<Example title="Combobox - Autocomplete - Entity - Keyboard interactions">

  <CodeView style={{maxWidth: '40rem', height: '10rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-17"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-17" snapshot={Snapshot.EntityOptionsFocused} type="entity" count={2} />}
      aria-activedescendant="option1"
      isOpen
      hasFocus
    />
  </CodeView>

</Example>

### Selecting an option

The user again can click on the desired option or press the `Enter` key with the desired option highlighted. The user can only select from the returned options; a plain text string is not a valid selection with the Entity Lookup.

The selected option is still set as the value of the text `input`, but this time we make the `input` look like a dismissable pill. This `input` becomes readonly at this point, so the user can no longer type into it.

To remove the selected option, simply press the `Delete` key when focused inside the text `input` or click the remove "x".

<Blockquote type="a11y" header="Accessibility Requirement">
  When the option is selected, make sure to add the <code className="doc">readonly</code> attribute to the text <code className="doc">input</code>. Be sure to remove it again when the option is cleared.
</Blockquote>

<Example title="Combobox - Autocomplete - Entity - Single selection">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-18"
      inputIconPosition="left-right"
      leftInputIcon={
        <StandardIcon
          symbol="account"
          className="slds-icon_small"
          containerClassName="slds-combobox__input-entity-icon"
          assistiveText="Account"
          title="Account"
        />
      }
      rightInputIcon={
        <ButtonIcon
          className="slds-input__icon slds-input__icon_right"
          symbol="close"
          title="Remove selected option"
          assistiveText="Remove selected option"
        />
      }
      listbox={<Listbox id="listbox-id-18" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
      hasSelection
      value="Salesforce.com, Inc."
      readonly
    />
  </CodeView>

</Example>

### Multiple selection

Multiple selection is handled the same as the Base and Autocomplete Combobox, a list of selected entities is displayed under the combobox as a [Listbox of Pills](/components/pills?variant=listbox-of-pill-options).

<Example title="Combobox - Autocomplete - Entity - Multiple Selection">

  <CodeView style={{maxWidth: '40rem'}}>
    <Combobox
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-19"
      autocomplete
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      listbox={<Listbox id="listbox-id-19" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
      hasSelection
      listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={2} />}
    />
  </CodeView>

</Example>

## Grouped Comboboxes (Cross-entity / Polymorphic)

The Grouped Comboboxes should be used when a Combobox has another Combobox appended or prepended to itself.

The containing `div` of the comboboxes should have the class `slds-combobox-group` on it.

<Blockquote type="warning" header="Keep in mind">
  The grouped combobox only accepts <em>one</em> addon, in addition to the primary combobox. Use the classes <code className="doc">slds-combobox_addon-start</code> and <code className="doc">slds-combobox_addon-end</code> to describe the position of the form element.
</Blockquote>

<Blockquote type="a11y" header="Accessibility Requirement">
  Be sure to set <code className="doc">aria-controls</code> on the Object Switcher, which points to the Search Combobox ID.
</Blockquote>

<Example title="Combobox - Grouped">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-20"
      comboboxID="primary-combobox-id-1"
      autocomplete
      listbox={<Listbox id="listbox-id-20" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
      addon={<ObjectSwitcher id={_.uniqueId('combobox-id-')} value="Accounts" addonPosition="start" hasInteractions comboboxAriaControls="primary-combobox-id-1" />}
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      hasInteractions
    />
  </CodeView>

</Example>

### User input (Typeahead)

<Example title="Combobox - Grouped - User input">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-activedescendant="option0"
      aria-controls="listbox-id-21"
      comboboxID="primary-combobox-id-2"
      autocomplete
      listbox={<Listbox id="listbox-id-21" snapshot={Snapshot.EntityOptionsTypeahead} term="salesforce" type="entity" count={4} />}
      value="salesforce"
      isOpen
      hasFocus
      addon={ <ObjectSwitcher id={_.uniqueId('combobox-id-')} value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-2" /> }
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
    />
  </CodeView>

</Example>

### User input (Typeahead) - Loading

<Example title="Combobox - Grouped - User input - Loading">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-activedescendant="option0"
      aria-controls="listbox-id-21"
      comboboxID="primary-combobox-id-2"
      autocomplete
      listbox={<Listbox id="listbox-id-21" snapshot={Snapshot.EntityOptionsTypeahead} term="salesforce" type="entity" count={4} />}
      value="salesforce"
      isOpen
      showCloseButton
      isLoading
      hasFocus
      addon={ <ObjectSwitcher id={_.uniqueId('combobox-id-')} value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-2" /> }
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="group-right"
    />
  </CodeView>

</Example>

### Selecting options

<Example title="Combobox - Grouped - Selecting options">

  <CodeView style={{maxWidth: '40rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-22"
      comboboxID="primary-combobox-id-3"
      autocomplete
      listbox={<Listbox id="listbox-id-22" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
      hasFocus
      addon={ <ObjectSwitcher id={_.uniqueId('combobox-id-')} value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-3" /> }
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      hasSelection
      listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={2} />}
    />
  </CodeView>

</Example>

### User input with selection(s) made

<Example title="Combobox - Grouped - User inptu with selections made">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-23"
      comboboxID="primary-combobox-id-4"
      autocomplete
      listbox={<Listbox id="listbox-id-23" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
      isOpen
      hasFocus
      addon={ <ObjectSwitcher id={_.uniqueId('combobox-id-')} value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-4" /> }
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      hasSelection
      listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={2} />}
    />
  </CodeView>

</Example>

### Selected options overflow

When a user is not focused on any element inside of the combobox group, the pill container should become collapsed to reduce vertical space.

The combobox group element needs the class `slds-has-selection` when a selection has been made. The pill selections are found inside of a [Listbox of Pills](/components/pills?variant=listbox-of-pill-options) located after the combobox group. It requires the class `slds-listbox_selection-group` to provide appropriate styling for the expanding and collapsing behavior of this region.

#### Collapsed

By default, the `slds-listbox_selection-group` is collapsed.

<Example title="Combobox - Grouped - Collapsed pills">

  <CodeView style={{maxWidth: '40rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-24"
      comboboxID="primary-combobox-id-5"
      autocomplete
      listbox={<Listbox id="listbox-id-24" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
      addon={ <ObjectSwitcher id={_.uniqueId('combobox-id-')} value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-5" /> }
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      hasSelection
      listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={8} />}
    />
  </CodeView>

</Example>

#### Expanded

When a user focuses on _any_ element inside of the combobox group, the class `slds-is-expanded` should be applied to the `slds-listbox_selection-group`. The selection group should remain open until the user moves away from any element inside the combobox group.

<Example title="Combobox - Grouped - Expanded pills">

  <CodeView style={{maxWidth: '40rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-25"
      comboboxID="primary-combobox-id-6"
      autocomplete
      listbox={<Listbox id="listbox-id-25" snapshot={Snapshot.EntityOptions} type="entity" count={4} />}
      hasFocus
      addon={ <ObjectSwitcher id={_.uniqueId('combobox-id-')} value="Accounts" addonPosition="start" comboboxAriaControls="primary-combobox-id-6" /> }
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
      hasSelection
      listboxOfSelections={<ListboxOfSelections snapshot={Snapshot.EntitySelections} count={8} isExpanded />}
    />
  </CodeView>

</Example>

For mouse users, clicking on the "+{x} more" text would expand the selection group and place the user's focus on the first pill inside the Listbox of Pills.

### Scoping results

A grouped combobox is intended to be used to filter down or scope you search results. You can do so by interacting with the object switcher to scope down to an object type.

The containing element should receive the class `slds-combobox_object-switcher` and `slds-combobox_addon-start`.

#### Text variant

<Example title="Combobox - Grouped - Scoping text variant">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-26"
      comboboxID="primary-combobox-id-7"
      autocomplete
      listbox={<Listbox id="listbox-id-26" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
      addon={<ObjectSwitcher id={_.uniqueId('combobox-id-')} value="Accounts" addonPosition="start" isOpen hasFocus comboboxAriaControls="primary-combobox-id-7" />}
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
    />
  </CodeView>

</Example>

#### Icon variant

<Blockquote type="a11y" header="Accessibility Note">
  When a selection is made, the currently selected items should be prepended with a <code className="doc">&lt;span className="slds-assistive-text"&gt;Current Selection:&lt;/span&gt;</code> to inform screen readers of its current selection.
</Blockquote>

##### Blurred
<Example title="Combobox - Grouped - Scoping icon variant - Blurred">

  <CodeView style={{maxWidth: '40rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-28"
      comboboxID="primary-combobox-id-9"
      autocomplete
      listbox={<Listbox id="listbox-id-28" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
      addon={<IconObjectSwitcher id={_.uniqueId('combobox-id-')} value="Apex" filteredSymbol="apex" addonPosition="start" comboboxAriaControls="primary-combobox-id-9" />}
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
    />
  </CodeView>

</Example>

##### Focused
<Example title="Combobox - Grouped - Scoping icon variant">

  <CodeView style={{maxWidth: '40rem', height: '15rem'}}>
    <ComboboxGroup
      id={_.uniqueId('combobox-id-')}
      aria-controls="listbox-id-27"
      comboboxID="primary-combobox-id-8"
      autocomplete
      listbox={<Listbox id="listbox-id-27" snapshot={Snapshot.EntityOptions} type="entity" count={2} />}
      addon={<IconObjectSwitcher id={_.uniqueId('combobox-id-')} value="Apex" filteredSymbol="apex" addonPosition="start" isOpen hasFocus comboboxAriaControls="primary-combobox-id-8" />}
      addonPosition="start"
      comboboxPosition="end"
      inputIconPosition="right"
      rightInputIcon={
        <UtilityIcon
          symbol="search"
          className="slds-icon slds-icon_x-small slds-icon-text-default"
          containerClassName="slds-input__icon slds-input__icon_right"
          assistiveText={false}
          title={false}
        />
      }
    />
  </CodeView>

</Example>
